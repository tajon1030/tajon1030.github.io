---
layout: post
title: potenday ì§„í–‰í•˜ë©´ì„œ ì•Œê²Œ ëœ ê²ƒ ì •ë¦¬
subtitle: CI/CD, ë°°í¬, jwt, mysql ë“±
tags: [cicd, jwt, ncp, mysql, cors, Jasypt]
comments: true
---

## 1. CI/CDêµ¬ì¶•
### CI
CIë€ Continuous Integrationì˜ ì¤„ì„ë§ë¡œ í•œê¸€ë¡œ ë²ˆì—­í•˜ë©´ **ì§€ì†ì ì¸ í†µí•©**ì´ë‹¤. ì§€ì†ì ì¸ í†µí•©ì´ë€ ë¬´ì—‡ì´ê³  ì–´ë–»ê²Œ í™œìš©ë˜ëŠ”ê²ƒì¼ê¹Œ?  
ì§€ì†ì  í†µí•©ì€ ì½”ë“œì˜ ë³€ê²½ ì‚¬í•­ì„ ì§€ì†ì ìœ¼ë¡œ(ìì£¼) í†µí•©í•˜ëŠ” ê³¼ì •ì„ ë§í•œë‹¤. ê°œë°œ í›„ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ëŠ” ë³€ê²½(ë²„ê·¸)ì„ ê°€ëŠ¥í•œ ë¹ ë¥´ê²Œ ë°œê²¬í•˜ê¸° ìœ„í•´ í™œìš©ë˜ë©° ë”°ë¼ì„œ ìë™í™”ëœ í…ŒìŠ¤íŠ¸ê°€ ë°˜ë“œì‹œ ì¡´ì¬í•´ì•¼ í•œë‹¤.  
ê²°êµ­ ì‰½ê²Œ ìƒê°í•˜ë©´ CIëŠ” ì‘ì„±í•œ ì½”ë“œë¥¼ ì§€ì†ì ìœ¼ë¡œ ë¹Œë“œ í…ŒìŠ¤íŠ¸í•˜ê³  í†µí•©í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

### CD
CDëŠ” í•­ìƒ ì‹ ë¢°ê°€ëŠ¥í•œ ìˆ˜ì¤€ì—ì„œ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë°°í¬í•  ìˆ˜ ìˆë„ë¡ ê´€ë¦¬í•˜ìëŠ” ê°œë…ìœ¼ë¡œ, í…ŒìŠ¤íŠ¸ë¥¼ ê±°ì¹œ ì½”ë“œë¥¼ ì €ì¥ì†Œì— ìë™ìœ¼ë¡œ ì—…ë¡œë“œí•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ëŠ” ì§€ì†ì  ì œê³µ(Continuous Delivery)ê³¼ ë³‘í•©ëœ ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ìš´ì˜ í™˜ê²½ì— ë°°í¬í•˜ëŠ” ì§€ì†ì  ë°°í¬(Continuous Deployment)ë¥¼ ë§í•œë‹¤.

### GithubActions
CI/CDë¥¼ ì ìš©í•˜ëŠ” ë°©ë²•ìœ¼ë¡œëŠ” ì—¬ëŸ¬ ê°€ì§€ ë°©ì‹(Github Actions, Jenkins, Travis CI, Azure DevOps ë“±)ì´ ìˆë‹¤. ê·¸ì¤‘ì—ì„œë„ ë‚˜ëŠ” **Github Actions**ë¥¼ ì´ìš©í–ˆë‹¤.
Github ActionsëŠ” Githubì—ì„œ ê³µì‹ì ìœ¼ë¡œ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ, Githubí˜ì´ì§€ì—ì„œ ë°”ë¡œ ë¹Œë“œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë©°, ë¬´ë£Œì´ê³ , ì„¤ì •ì´ ì‰½ê¸° ë•Œë¬¸ì— ì±„íƒí•˜ì˜€ë‹¤.

### GithubActionsì‚¬ìš©ë²•
GithubActionsë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ê°„ë‹¨í•˜ë‹¤.  
**GitHub ë ˆí¬ì§€í† ë¦¬** - **Actions** - **Continuous integration**ì—ì„œ **Java with  Gradle**ì˜ **Configure**ë¥¼ í´ë¦­í•˜ë©´ **~/.github/workflow/gradle.yml**ë¼ëŠ” íŒŒì¼ì´ ìƒì„±ëœë‹¤. ì´í›„ ë³¸ì¸ì˜ í™˜ê²½ì— ë§ê²Œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜ì •í•˜ë©´ ëœë‹¤.

í”„ë¡œì íŠ¸ì—ì„œ CIë¥¼ êµ¬ì„±í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ì˜€ë‹¤.  
ì „ì²´ í”„ë¡œì„¸ìŠ¤ë¥¼ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ìë©´, ì €ì¥ì†Œì˜ mainê³¼ devë¸Œëœì¹˜ì— prì´ ìƒì„±ë  ë•Œ application.yml íŒŒì¼ì— githubActionsì— ì„¤ì •í•´ë‘” ì‹œí¬ë¦¿í‚¤ë¥¼ ì„¸íŒ…ì‹œì¼œì„œ(í”„ë¡œì íŠ¸ë¥¼ publicìœ¼ë¡œ ì„¤ì •í•˜ì˜€ê¸° ë•Œë¬¸ì— ê°œì¸ì •ë³´ë¥¼ application.ymlíŒŒì¼ì— ê·¸ëŒ€ë¡œ ë…¸ì¶œ ì‹œí‚¬ ìˆ˜ ì—†ì—ˆìŒ) buildí•˜ëŠ” ê³¼ì •ì´ë‹¤.
```yml
name: Java CI with Gradle

on:
  pull_request:
    branches: [ "main", "dev" ]

permissions:
  contents: read

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
    - name: Set Yaml
      uses: microsoft/variable-substitution@v1
      with:
        files: ./src/main/resources/application.yml
      env:
        jasypt.encryptor.password: ${{ secrets.JASYPT_PW }}
        server.ssl.key-store-password: ${{ secrets.SSL_PW }}
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
    - name: Build with Gradle
      run: ./gradlew build
```
CDë¥¼ êµ¬ì„±í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ì˜€ë‹¤.
```yml
## ì‘ì—…ëª…
name: CD NCP

## ì‹¤í–‰ ë¸Œëœì¹˜ - mainë¸Œëœì¹˜ì— pushê°€ ë°œìƒí•  ê²½ìš°
on:
  push:
    branches: [ "main" ]

permissions:
  contents: read

jobs:
  build:
  
    runs-on: ubuntu-latest

    steps:
    ## Project JDK 17 Setting
    - name: CheckOut
      uses: actions/checkout@v3
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
    
    - name: Set Yaml
      uses: microsoft/variable-substitution@v1
      with:
        files: ./src/main/resources/application.yml
      env:
        jasypt.encryptor.password: ${{ secrets.JASYPT_PW }}
        server.ssl.key-store-password: ${{ secrets.SSL_PW }}
        social.kakao.redirect: https://one-line-a-day-kappa.vercel.app/oauth/kakao/redirect


    ## Gradle ì‚¬ìš©ê¶Œí•œ ì…‹íŒ…
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
        
    ## main ë¸Œëœì¹˜ì¼ê²½ìš° application.yml íŒŒì¼ ì œì‘
    - name: make application.yml
      if: contains(github.ref, 'main')
      run: |
        cd ./src/main/resources
        touch ./application-prod.yml
        echo "${{ secrets.APPLICATION_PROD }}" > ./application-prod.yml

    ## í”„ë¡œì íŠ¸ ë¹Œë“œ
    - name: Build with Gradle
      run: ./gradlew clean build

    ## sshì ‘ì† í›„ jaríŒŒì¼ ì˜®ê¸°ê¸°
    - name: Delivery jar to remote ssh
      uses: appleboy/scp-action@master
      with:
        host: ${{ secrets.NCP_SERVER_IP }}
        username: ${{ secrets.NCP_SERVER_USER }}
        password: ${{ secrets.NCP_SERVER_PASSWORD }}
        port: ${{ secrets.NCP_SERVER_PORT }}
        source: "build/libs/*.jar"
        target: "./source/"
        rm: true
        
    ## ssh ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
    - name: Executing remote ssh commands using password
      uses: appleboy/ssh-action@v0.1.8
      with:
        host: ${{ secrets.NCP_SERVER_IP }}
        username: ${{ secrets.NCP_SERVER_USER }}
        password: ${{ secrets.NCP_SERVER_PASSWORD }}
        port: ${{ secrets.NCP_SERVER_PORT }}
        script: |
          bash ./deploy.sh
```

### ë°°í¬ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
**Shell Script** ë€ ìŠ¤í¬ë¦½íŠ¸ ì•ˆì— ë¯¸ë¦¬ ëª…ë ¹ì–´ë¥¼ ì‘ì„±í•´ ë†“ì€ ê²ƒìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ëª…ë ¹ì–´ê°€ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë˜ì–´ ë°˜ë³µë˜ëŠ” ì¼ì„ ìë™í™”í•˜ëŠ”ë° ì´ìš©í•  ìˆ˜ ìˆë‹¤.  
íŒŒì¼ì˜ ë§¨ ì²˜ìŒì— `#!/bin/bash`ë¥¼ ì‘ì„±í•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì´ë¼ëŠ” ê²ƒì„ ëª…ì‹œí•œë‹¤.
```bash
#!/bin/bash

SOURCE_DIR=source/build/libs
FILE_NAME=`find $SOURCE_DIR/&.SNAPSHOT.jar -printf "%f\n`

echo ">í˜„ì¬ êµ¬ë™ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ pidí™•ì¸"
CURRENT_PID=`ps -ef | grep -v "grep" | grep "java" | awk '{print $2}'`

echo "> í˜„ì¬ êµ¬ë™ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ pid: $CURRENT_PID"
if [ -z "$CURRENT_PID" ]; then
	echo "#### THERE IS NO PROCESS ####"
else
	echo "> kill -15 $CURRENT_PID"
	kill -15 $CURRENT_PID
	sleep 5
fi

echo "#### RUN $SOURCE_DIR/$FILE_NAME ####"
sudo nohup java -jar -Dspring.profiles.active=prod $SOURCE_DIR/$FILE_NAME 1> log.txt 2>&1 &
```
ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± í›„ ì‹¤í–‰ ê¶Œí•œì„ ë¶€ì—¬í•´ì¤€ë‹¤.  
`chmod _x ./[íŒŒì¼ëª…].sh`  
ì‹¤í–‰ì€ `[íŒŒì¼ëª…].sh` ì„ ì„ ì–¸í•˜ë©´ ëœë‹¤.

#### GithubActions ì„¤ì •ì„ ìœ„í•´ ì°¸ê³ í•œ ì‚¬ì´íŠ¸ë“¤
- https://zzang9ha.tistory.com/404?category=954133
- https://veluxer62.github.io/tutorials/tutorial-of-continuous-deployment-with-git-actions/
- https://velog.io/@wonizizi99/Web-ê¹ƒì•¡ì…˜ì„-ì´ìš©í•œ-CI-CD
- [https://zyngirok.com/entry/AWS-ì´ìš©í•´ì„œ-ì›¹ì‚¬ì´íŠ¸-ë§Œë“¤ê¸°-GitHubì„-ì´ìš©í•œ-ë°°í¬-deploy-script-ì‘ì„±](https://zyngirok.com/entry/AWS-%EC%9D%B4%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%9B%B9%EC%82%AC%EC%9D%B4%ED%8A%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0-GitHub%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%B0%B0%ED%8F%AC-deploy-script-%EC%9E%91%EC%84%B1)
- https://jihyee.tistory.com/21

## 2. jwtë¥¼ ì´ìš©í•œ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
### jwt
ê¸°ì¡´ì˜ ì„¸ì…˜ì¿ í‚¤ ì¸ì¦ ë°©ì‹ì˜ ë¡œê·¸ì¸ êµ¬í˜„ì´ ê°€ëŠ¥í•¨ì—ë„ ë¶ˆêµ¬í•˜ê³  jwtë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œ?  
ì„¸ì…˜/ì¿ í‚¤ë°©ì‹ì€ ì„œë²„ê°€ ì„¸ì…˜ì„ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë°©ì‹ì´ê¸°ë•Œë¬¸ì— ì„œë²„ ì¦ì„¤ì‹œì— ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. (ì´ëŸ´ê²½ìš° ì„¸ì…˜ í´ëŸ¬ìŠ¤í„°ë§ì´ë‚˜ redisë¥¼ ì´ìš©í•˜ì—¬ ì„¸ì…˜ìŠ¤í† ë¦¬ì§€ ë¶„ë¦¬ ë°©ì‹ì„ ì ìš©í•˜ë©´ ë˜ê¸´ í•˜ë‹¤.) ì´ëŸ° ì„¸ì…˜/ì¿ í‚¤ ì¸ì¦ë°©ì‹ì€ ì‹œê°„ì  ë¹„íš¨ìœ¨ì„±ì´ ë°œìƒí•œë‹¤ëŠ” ë‹¨ì ì´ ìˆê¸°ë•Œë¬¸ì— í—¤ë”ì— í† í°ê°’ë§Œ ì „ë‹¬í•˜ë©´ ë˜ê³  ì„¸ì…˜ ì„œë²„ì— ì¡°íšŒí•˜ëŠ” ì‹œê°„ì´ ë°œìƒí•˜ì§€ ì•ŠëŠ” jwtì¸ì¦ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤.

jwtëŠ” header.payload.signatureë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤. headerì—ëŠ” ì„œëª… ì•Œê³ ë¦¬ì¦˜ ì •ë³´ê°€, payloadì—ëŠ”  Claimì´ë¼ëŠ” ê¶Œí•œ ì •ë³´, signatureì—ëŠ” ì•Œê³ ë¦¬ì¦˜ì— ë”°ë¼ ìœ„ ë‘ê°’ê³¼ ë¹„ë°€í‚¤ë¥¼ ì•”í˜¸í™”í•œ ê°’(HMAC with SHA256=HS256)ì´ë‚˜ ë‘ ê°’ì„ ì•”í˜¸í™”í•œ ê°’(RSA with SHA256 = RS256)ì´ ë“¤ì–´ê°„ë‹¤.  
ì°¸ê³ ë¡œ headerì™€ payloadëŠ” ì¸ì½”ë”©ë§Œ í•  ë¿ ì•”í˜¸í™”ë˜ì§€ëŠ” ì•Šê¸° ë•Œë¬¸ì— í† í°ì— ì‚¬ìš©ìë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ” ê°’(PKê°’,ê¶Œí•œ)ë§Œ ë„£ì–´ì•¼ì§€ ë¹„ë°€ë²ˆí˜¸ë‚˜ ì‚¬ìš©ìë¥¼ íŠ¹ì •í•  ìˆ˜ ìˆëŠ” ê°œì¸ì •ë³´ë¥¼ ë‹´ì•„ì„œëŠ” ì•ˆëœë‹¤.

ê·¸ëŸ¬ë‚˜ í† í°ì´ íƒˆì·¨ë‹¹í•  ê²½ìš° ë§Œë£Œë˜ê¸° ì „ê¹Œì§€ ë§ˆìŒë†“ê³  í•´í‚¹ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ë‹¨ì ë„ ì¡´ì¬í•œë‹¤.  
ë”°ë¼ì„œ AccessTokenê³¼ RefreshToken ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ í† í°ì˜ ë§Œë£Œì‹œê°„ì€ ì§§ê²Œ ì¡ê³  RefreshTokenì„ ì´ìš©í•˜ì—¬ ì•¡ì„¸ìŠ¤í† í°ê³¼ ë¦¬í”„ë ˆì‹œ í† í°ì„ ì¬ë°œê¸‰í•´ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” ë°©ì‹ì„ ì´ìš©í•œë‹¤.


### ë¸”ë™ë¦¬ìŠ¤íŠ¸
jwtê¸°ë°˜ ì‚¬ìš©ì ì¸ì¦ì—ì„œ logoutì„ êµ¬í˜„í• ë•Œ Refresh Tokenì„ ë§Œë£Œì²˜ë¦¬ í•˜ë©´ ë˜ì§€ë§Œ ê¸°ì¡´ì˜ ì•¡ì„¸ìŠ¤í† í°ìœ¼ë¡œ ì ‘ê·¼í•œë‹¤ë˜ì§€ í•˜ëŠ” ë¬¸ì œê°€ ìˆë‹¤. ë˜í•œ ë³¸ í”„ë¡œì íŠ¸ëŠ” ë¦¬í”„ë ˆì‹œ í† í°ì€ êµ¬í˜„í•˜ì§€ ì•Šê³  ì•¡ì„¸ìŠ¤ í† í°ì˜ ê¸°ê°„ë§Œ ê¸¸ê²Œ ë§Œë“¤ì–´ë²„ë ¸ê¸°ë•Œë¬¸ì— ì–´ì©” ìˆ˜ ì—†ì´ ë¡œê·¸ì•„ì›ƒí•œ Access Tokenì„ Blacklistë¡œ redisì— ì €ì¥í•˜ì—¬ ì²˜ë¦¬í•˜ë„ë¡ êµ¬í˜„í•´ì•¼ë§Œ í–ˆë‹¤.

### ëŠë‚€ì 
jwtì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ì„œ RefreshTokenì„ ìƒì„±í•˜ì§€ ì•Šì•˜ê¸°ë•Œë¬¸ì— ë¸”ë™ë¦¬ìŠ¤íŠ¸ë„ ì¶”ê°€í•˜ê³  ë³´ì•ˆì ìœ¼ë¡œ ë¶ˆì•ˆì •í•œ ë¡œê·¸ì¸ë°©ì‹ì´ ë˜ì—ˆë‹¤ëŠ” ìƒê°ì´ ë“ ë‹¤. ì´ëŸ´ê±°ë©´ ê·¸ëƒ¥ ì„¸ì…˜ë°©ì‹ì„ ì‚¬ìš©í• ê±¸ê·¸ë¬ë‹¤ëŠ” ìƒê°ë„ ë“¤ê¸°ë„ í–ˆëŠ”ë°, jwtë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ì— ëŒ€í•´ í¬ê²Œ ìƒê°í•˜ì§€ ì•Šê³  ê·¸ëƒ¥ ì ìš©í•˜ë‹¤ë³´ë‹ˆ ì´ë ‡ê²Œ ëë‹¤ê³  ìƒê°í•œë‹¤. í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ê¸°ìˆ ì„ ì ìš©í• ë•Œì—ëŠ” ì™œ ì´ ê¸°ìˆ ì„ ì ìš©í•´ì•¼í•˜ëŠ”ì§€ì— ëŒ€í•´ì„œ ê¹Šê²Œ ìƒê°í•´ë³´ê³  ì§„í–‰í•´ì•¼ê² ë‹¤ëŠ” êµí›ˆì„ ì–»ì„ ìˆ˜ ìˆì—ˆë‹¤.

#### ì°¸ê³ í•œ ì‚¬ì´íŠ¸ë“¤
https://velog.io/@u-nij/JWT  
https://ws-pace.tistory.com/247?category=1025277

## 3. mysql ì—°ì† ë‚ ì§œ ê³„ì‚°
ê¸°ëŠ¥ ì¤‘ì— **'ìš°ë¦¬ê°€ ì—°ì†í•´ì„œ ë§Œë‚œ ë‚ '** ì´ë¼ê³  í•˜ì—¬ ì‘ì„±í•œ ì•„ì¹´ì´ë¸Œë¥¼ í† ëŒ€ë¡œ ì—°ì† ì‘ì„± ì¼ìë¥¼ êµ¬í•˜ëŠ” ê²ƒì´ í•„ìš”í–ˆë‹¤.  
ë‹¹ì¼ ì‘ì„±í•œ ì•„ì¹´ì´ë¸Œê°€ ì—†ë”ë¼ë„ ì „ë‚  ì‘ì„±í•œ ì•„ì¹´ì´ë¸Œê°€ ìˆë‹¤ë©´ ì „ë‚ ì„ ê¸°ì¤€ìœ¼ë¡œ ì—°ì† ì‘ì„± ì¼ìë¥¼ ë¦¬í„´í•´ì£¼ë„ë¡ í•´ì•¼í•œë‹¤ëŠ” ì¡°ê±´ì´ ìˆë‹¤.  
ì—°ì†ì¼ê³¼ ê¸°ì¤€ì¼ì„ ì»¬ëŸ¼ìœ¼ë¡œ ë‘ì–´ ì•„ì¹´ì´ë¸Œë¥¼ ìƒˆë¡œ ì‘ì„±í•  ë•Œ ì»¬ëŸ¼ì„ ì—…ë°ì´íŠ¸í•´ì£¼ê³  ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ ë§¤ì¼ 0ì‹œì— ì—°ì†ì¼ì„ ì¬ê³„ì‚°í•˜ì—¬ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ì„ ìƒê°í•˜ì˜€ìœ¼ë‚˜ ê·¸ë ‡ê²Œ í•˜ë©´ ì‘ì„±ì„ í•  ë•Œë§ˆë‹¤ ë¶ˆí•„ìš”í•œ ì¿¼ë¦¬ê°€ ì‹¤í–‰ëœë‹¤ëŠ” ë‹¨ì  ë•Œë¬¸ì— ì—°ì†í•´ì„œ ë§Œë‚œ ë‚ ì„ ì¡°íšŒí•  ë•Œë§ˆë‹¤ ê³„ì‚°í•´ì„œ ë³´ì—¬ì£¼ë„ë¡ í•˜ì˜€ë‹¤.

### ì¿¼ë¦¬ ì‘ì„±
ì¿¼ë¦¬ì‘ì„±ì€ ì—°ì† ì¶œì„ì¼ì„ êµ¬í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ì°¸ê³ í•´ì„œ ì‘ì„±í•˜ì˜€ë‹¤.  
row_number í•¨ìˆ˜ëŠ” ìˆœì„œí•¨ìˆ˜ over ì´í•˜ì— ì íŒ ì •ë ¬ìˆœì„œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìˆœì„œë¥¼ ë§¤ê¸´ë‹¤.(1)
ì•„ì¹´ì´ë¸Œ ìƒì„±ì¼ê³¼ ë³€ë™ì´ ì—†ëŠ” ì•„ë¬´ë‚ ì§œ(ì—¬ê¸°ì„œëŠ” í˜„ì¬ë‚ ì§œ)ë¥¼ datediffí•˜ì—¬ ì°¨ì´ê°€ ë‚˜ëŠ” ì¼ìˆ˜ë¥¼ êµ¬í•˜ê³ (2)  
ìˆœì„œê°’(1)ê³¼ ì°¨ì´ê°’(2)ì„ ë”í–ˆì„ë•Œ(3) ê°™ì€ ìˆ˜ê°€ ë‚˜ì˜¤ë©´ ì—°ì†ì ìœ¼ë¡œ ìƒì„±í–ˆìŒì„ ëœ»í•œë‹¤.  
(3)ì„ ê·¸ë£¹í™”í•˜ì—¬ ì¡°íšŒëœ ê°¯ìˆ˜ë¥¼ ë”í•˜ë©´ ì—°ì†ì¼ì´ ëœë‹¤.  
ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê²ƒì€ ë§ˆì§€ë§‰ ìƒì„±ì¼ì´ ì–´ì œ í˜¹ì€ ì˜¤ëŠ˜ì¸ ê²ƒì´ë¯€ë¡œ ì¡°ê±´ì ˆì— ë„£ì–´ì„œ ê³„ì‚°í•˜ë©´ ì›í•˜ëŠ” ì—°ì†ì¼ì„ êµ¬í•  ìˆ˜ ìˆë‹¤.
```sql
select continuity from (
	select max(created_dt) as 'ì¢…ë£Œì¼'
	, count(*) as continuity
	from(
		select created_dt
		, (row_number() over(order by created_dt) + datediff(CURDATE(), created_dt)) as 'consecutive_day'
		from (
			select distinct date_format(created_dt,'%y-%m-%d') as created_dt 
			from archive 
			where user_id = :userId
		) a
	) b
	group by consecutive_day
) c
where ì¢…ë£Œì¼ = curdate() or ì¢…ë£Œì¼ = subdate(curdate(), 1)
```

### mysql ë²„ì „ì— ë”°ë¥¸ ë¬¸ì œ
ì¿¼ë¦¬ë¥¼ ë‹¤ ì‘ì„±í•˜ê³  ì‹¤í–‰ì‹œì¼°ëŠ”ë° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤. ë¬¸ì œì¸ê³ ë¡œ mysqlì˜ ë²„ì „ì´ ë‹¬ë¼ ìƒê¸´ ë¬¸ì œì¸ë° ë¡œì»¬ì—ì„œëŠ” mysql 8.0ë²„ì „ì´ì—ˆì§€ë§Œ ë°°í¬ ì„œë²„ì— ì„¤ì¹˜í•œ mysqlì€ 5.7ë²„ì „ì´ì—ˆë˜ ê²ƒì´ë‹¤.  
mysql5.7ë²„ì „ì—ì„œëŠ” row_number over ì´ë¼ëŠ” í•¨ìˆ˜ê°€ ì—†ê¸° ë•Œë¬¸ì— í•´ë‹¹ ì¿¼ë¦¬ë¥¼ ìˆ˜ì •í•˜ì—¬ ë°°í¬í•˜ì˜€ë‹¤.
```sql
select continuity from (
	select max(created_dt) as 'ì¢…ë£Œì¼'
	, count(*) as continuity
	from(
		select ((@row_number := @row_number + 1) + datediff(created_dt, CURDATE())) as 'consecutive_day'
		, created_dt
		from (
			select distinct date_format(created_dt,'%y-%m-%d') as created_dt 
			from archive 
			where user_id = :userId
		) a,
		(SELECT @row_number := 0) AS x
		ORDER BY created_dt DESC
	) b
	group by consecutive_day
) c
where ì¢…ë£Œì¼ = curdate() or ì¢…ë£Œì¼ = subdate(curdate(), 1)
```

### ì„±ëŠ¥ ê°œì„ 
í•˜ì§€ë§Œ ì´ ë°©ì‹ì€ ì—°ì†ì¼ì„ ì¡°íšŒí•  ë•Œë§ˆë‹¤ ì „ì²´ ì•„ì¹´ì´ë¸Œë¥¼ ì¡°íšŒí•´ì„œ ê³„ì‚°í•´ì•¼í•˜ë¯€ë¡œ ì„±ëŠ¥ì  ë¬¸ì œë¥¼ ìƒê°í•´ë³´ì§€ì•Šì„ìˆ˜ê°€ ì—†ì„ ê²ƒì´ë‹¤. ë”°ë¼ì„œ ì²˜ìŒ ë¡œê·¸ì¸í–ˆì„ ë•Œ ê³„ì‚°í•œ ì—°ì†ì¼ì„ redisì— ì €ì¥í•´ë‘ê³  ìƒˆ ì•„ì¹´ì´ë¸Œë¥¼ ì‘ì„±í•  ë•Œ redisê°’ì„ ì‚­ì œí•˜ë©´ ì¡°íšŒ íš¨ìœ¨ì„±ì„ ë†’ì¼ ìˆ˜ ìˆì„ê±°ë¼ ìƒê°í•œë‹¤. ì´ëŠ” ì¶”í›„ ìˆ˜ì •ì´ í•„ìš”í•  ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.

#### ì°¸ê³ í•œ ì‚¬ì´íŠ¸ë“¤
[https://nwairr.tistory.com/entry/ì¿¼ë¦¬-ì‘ì„±-ì˜ˆì œ-ì—°ì†ëœ-ë‚ ì§œ-ì§‘í•©-êµ¬í•˜ê¸°rownumber](https://nwairr.tistory.com/entry/%EC%BF%BC%EB%A6%AC-%EC%9E%91%EC%84%B1-%EC%98%88%EC%A0%9C-%EC%97%B0%EC%86%8D%EB%90%9C-%EB%82%A0%EC%A7%9C-%EC%A7%91%ED%95%A9-%EA%B5%AC%ED%95%98%EA%B8%B0rownumber)  
https://stackoverflow.com/questions/54239851/mysql-5-7-getting-the-row-number  
[curdateê³¼ nowì˜ ì°¨ì´](https://www.w3big.com/ko/sql/func-curdate.html#gsc.tab=0)  
https://linuxism.ustd.ip.or.kr/510  
https://steemit.com/kr/@segyepark/5r4bse-sql  

## 4. CORS
ë¡œì»¬ì—ì„œ ì™„ë²½í•˜ê²Œ ë™ì‘í•˜ì—¬ í”„ë¡ íŠ¸ì—ì„œë„ ì˜ ë™ì‘í• ì¤„ì•Œì•˜ëŠ”ë° CORSë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.  
CORS(Cross-Origin-Resource-Sharing)ì€ êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ ê³µìœ  ì •ì±…ì´ë¼ê³ ë„ í•˜ëŠ”ë° ë™ì¼í•œ ì¶œì²˜(**Protocol+Host+Port**)ì—ì„œë§Œ ë¦¬ì†ŒìŠ¤ë¥¼ ê³µìœ í•  ìˆ˜ ìˆë‹¤ëŠ” SOP(Same-Origin-Policy)ì— ë”°ë¼ **ë‹¤ë¥¸ ì¶œì²˜(Cross-Origin)ì„œë²„ì— ìˆëŠ” ë¦¬ì†ŒìŠ¤ëŠ” ìƒí˜¸ì‘ìš©ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤**ëŠ” ë§ì´ë‹¤.  
ì´ëŸ¬í•œ ì œì•½ì„ ë‘ëŠ” ì´ìœ ëŠ” CSRF(Cross-Site Request Forgery) ë‚˜ XSS(Cross-Site Scripting) ê³¼ ê°™ì€ ë³´ì•ˆìƒ ì´ìŠˆë¥¼ ì‚¬ì „ì— ë°©ì§€í•˜ê¸°ìœ„í•´ì„œì§€ë§Œ, ì›¹í˜ì´ì§€ì—ì„œ ë‹¤ë¥¸ ì¶œì²˜ì— ìˆëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì™€ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ë§¤ìš° í”í•œ ì¼ì´ê¸° ë•Œë¬¸ì— ëª‡ê°€ì§€ ì˜ˆì™¸ ì¡°í•­ì„ ì§€í‚¤ë©´ í—ˆìš©í•˜ë„ë¡ í•˜ì˜€ë‹¤. ê·¸ì¤‘ í•˜ë‚˜ê°€ CORSë¥¼ ì§€í‚¨ ë¦¬ì†ŒìŠ¤ ìš”ì²­ìœ¼ë¡œ ì„œë²„ì—ì„œ **Access-Control-Allow-Originí—¤ë”ì— í—ˆìš©í•  ì¶œì²˜ë¥¼ ê¸°ì¬**í•´ì„œ í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µí•˜ë©´ ë˜ëŠ” ê²ƒì´ë‹¤.  
ë‚˜ëŠ” SpringBootë¥¼ ì´ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ì˜€ê¸° ë•Œë¬¸ì— SpringBootì—ì„œ Access-Control-Allow-Originí—¤ë”ë¥¼ ì„¸íŒ…í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ê³  ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì—ˆë‹¤.  
CorsRegistryì˜ defaultPermitMethodê°’ì´ GET, HEAD, POSTì´ê¸° ë•Œë¬¸ì— PUT ë©”ì„œë“œì˜ ê²½ìš° ë”°ë¡œ ì¶”ê°€ê°€ í•„ìš”í•˜ì—¬ allowedMethods ì†ì„±ì„ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.
```java
@SpringBootApplication
@EnableJpaAuditing
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }

    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping("/**")
                        .allowedOrigins("http://localhost:3000", "https://one-line-a-day-kappa.vercel.app") // í—ˆìš©í•  ì¶œì²˜
                        .allowedMethods("*"); // í—ˆìš©í•  HttpMethod
            }
        };
    }

}
```
ìœ„ì˜ ë°©ë²•ë§ê³ ë„ í”„ë¡ì‹œì„œë²„ë¥¼ ì´ìš©í•´ì„œ ëª¨ë“  ì¶œì²˜ë¥¼ í—ˆìš©í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

#### ì°¸ê³ í•œ ì‚¬ì´íŠ¸
[https://inpa.tistory.com/entry/WEB-ğŸ“š-CORS-ğŸ’¯-ì •ë¦¬-í•´ê²°-ë°©ë²•-ğŸ‘](https://inpa.tistory.com/entry/WEB-%F0%9F%93%9A-CORS-%F0%9F%92%AF-%EC%A0%95%EB%A6%AC-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95-%F0%9F%91%8F)  
https://spring.io/guides/gs/rest-service-cors/  
https://velog.io/@hellozin/Spring-API-ì„œë²„ì—ì„œ-PUT-DELETE-ìš”ì²­-ì‹œ-CORS-ì„¤ì •ì´-ì ìš©-ì•ˆë˜ëŠ”-ê²½ìš°  

## 5. Jasypt ì•”í˜¸í™”
JasyptëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ì‹œ ì½”ë“œë¥¼ publicí•œ ì €ì¥ì†Œì— ì˜¬ë ¤ë‘˜ ë•Œ DB ê³„ì •ì´ë‚˜ ì¤‘ìš” ë¹„ë°€ í‚¤ ê°’ë“¤ì´ í‰ë¬¸ ê·¸ëŒ€ë¡œ ì €ì¥ë˜ì–´ ì˜¬ë¼ê°€ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ **í”„ë¡œí¼í‹°ë¥¼ ê°„ë‹¨í•˜ê²Œ ì•”í˜¸í™”í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬**ì´ë‹¤.  
ì‚¬ì‹¤ jar ë°°í¬ ì‹œ ëª…ë ¹ì–´ë¡œ ê°’ì„ ì¶”ê°€í•´ì£¼ë©´ ë˜ì§€ë§Œ ì¶”ê°€í•´ì•¼í•˜ëŠ” í”„ë¡œí¼í‹° ê°’ì´ ë§ì„ ê²½ìš° ëˆ„ë½ ë¬¸ì œ ë“±ì´ ë°œìƒí• ìˆ˜ìˆê¸°ë•Œë¬¸ì— jasyptë¥¼ í™œìš©í•˜ëŠ” ë°©ì‹ì„ ì´ìš©í•˜ì˜€ë‹¤. Jasyptë¥¼ ì´ìš©í•˜ì—¬ DB password ë“±ì˜ ê°’ë“¤ì„ ì•”í˜¸í™”í•˜ê³  jasypt.encrypt.passwordë§Œ Github Repository Secretsë¡œ ì„¸íŒ…ì‹œì¼°ë‹¤.

#### ì°¸ê³ í•œ ì‚¬ì´íŠ¸
https://github.com/ulisesbocchio/jasypt-spring-boot  
https://lusida-coding.tistory.com/138

## 6. ì„œë²„ ë°°í¬
### ì„œë²„ êµ¬ì¶•(NCP)
í¬í…ë°ì´ì—ì„œ ë„¤ì´ë²„ í´ë¼ìš°ë“œ í¬ë ˆë”§ì„ ì œê³µí•´ì£¼ì–´ NCPì„œë²„ë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤. ì›ë˜ DBì„œë²„ëŠ” ë  ìˆ˜ ìˆìœ¼ë©´ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ì§€ë§Œ ì†Œê·œëª¨ í”„ë¡œì íŠ¸ì´ê¸°ë„ í•˜ê³  ë¹ ë¥´ê²Œ ë°°í¬í•˜ê¸°ìœ„í•´ì„œ Ubuntu ë‹¨ì¼ì„œë²„(Classic)ë¡œ êµ¬ì„±í–ˆë‹¤.  

| ì„œë²„ì´ë¯¸ì§€ | ZONE | ì„œë²„íƒ€ì… |  
|--|--|--|  
| Ubuntu18.04 | KR | Compact-g1 |  

ë‹¤ìŒê³¼ ê°™ì´ ì„œë²„ë¥¼ ì²˜ìŒ ìƒì„±í•˜ê³ ë‚˜ì„œ ê³µì¸IP(Instance ID)ë¥¼ ìƒì„±í•´ì£¼ì—ˆë‹¤.  
ì„œë²„ë¥¼ ìƒì„±í•˜ì˜€ìœ¼ë‹ˆ ì´ì œ ì„œë²„ì— mysqlê³¼ redisë¥¼ ì„¤ì¹˜í•´ì•¼í•˜ê³  ë°°í¬ìŠ¤í¬ë¦½íŠ¸ë„ ì‘ì„±í•´ì•¼í•œë‹¤.   ì´ëŸ¬í•œ ì‘ì—…ì„ í•˜ê¸°ìœ„í•´ì„œ ì›ê²©ìœ¼ë¡œ ì„œë²„ì— ì ‘ì†í•´ì•¼í•˜ëŠ”ë°, ë‚˜ëŠ” ê¸°ì¡´ì— ìì£¼ ì“°ë˜ putty ëŒ€ì‹  mobaXtermì´ë¼ëŠ” í”„ë¡œê·¸ë¨ì„ ì‚¬ìš©í•˜ì˜€ë‹¤. mobaXtermì„ ì´ìš©í•˜ë©´ ì„œë²„ì ‘ê·¼ë¹„ë°€ë²ˆí˜¸ë„ ì €ì¥í•  ìˆ˜ ìˆì–´ì„œ í•œë²ˆ ë¡œê·¸ì¸í•˜ë©´ ë‹¤ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•  í•„ìš” ì—†ì´ ì‰½ê²Œ ì ‘ì†ì´ ê°€ëŠ¥í•˜ë‹¤.  
ë°”ë¡œ ì ‘ì†ì„ í•˜ë ¤ê³ í•˜ë©´ ì‹¤íŒ¨í•˜ëŠ”ë° ì´ëŠ” ACGì„¤ì •ìœ¼ë¡œ í¬íŠ¸ë¥¼ ì—´ì–´ì£¼ëŠ” ì‘ì—…ì„ í•´ì•¼í•˜ê¸° ë•Œë¬¸ì´ë‹¤. í¬íŠ¸ë¥¼ ì—´ì–´ì£¼ëŠ”ê¹€ì— ssh í¬íŠ¸ë¿ë§Œ ì•„ë‹ˆë¼ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸ë¥¼ ì „ë¶€ ì—´ì–´ì£¼ì—ˆë‹¤. 

- ssh 22í¬íŠ¸(TCP 0.0.0.0/0 22)
- Tomcat 8080í¬íŠ¸(TCP 0.0.0.0/0 8080)
- http 80í¬íŠ¸(TCP 0.0.0.0/0 80)
- https 443í¬íŠ¸(TCP 0.0.0.0/0 443)
- mysql 3306í¬íŠ¸(TCP 0.0.0.0/0 3306)
- redis 6379í¬íŠ¸(TCP 0.0.0.0/0 6379)

ì°¸ê³ ë¡œ ì–´ëŠ ipì£¼ì†Œì—ì„œë“  ì ‘ê·¼ê°€ëŠ¥í•˜ë„ë¡ ì „ë¶€ 0.0.0.0/0ìœ¼ë¡œ ê°œë°©í•´ë†¨ëŠ”ë° ë³´ì•ˆì„ ìœ„í•´ ì ‘ì†ì„ ë§‰ê³  ì‹¶ë‹¤ë©´ myIPë‚˜ íŠ¹ì • ip ì£¼ì†Œë¥¼ ëª…ì‹œí•´ íŠ¹ì • ì£¼ì†Œì—ì„œë§Œ ì—°ê²°ì´ ê°€ëŠ¥í•˜ê²Œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

ì´ì œ ê³µì¸IPì™€ ì„œë²„ê´€ë¦¬ìë¹„ë°€ë²ˆí˜¸ë¥¼ ì´ìš©í•˜ì—¬ ì›ê²© ì ‘ì†ì„ í•  ìˆ˜ ìˆë‹¤.

### í¬íŠ¸í¬ì›Œë”©
ì›¹ë¸Œë¼ìš°ì €ì—ì„œëŠ” 80í¬íŠ¸ê°€ ê¸°ë³¸í¬íŠ¸ì´ê¸°ë•Œë¬¸ì— í˜„ì¬ìƒíƒœì—ì„œëŠ” ipë’¤ì— í¬íŠ¸ë²ˆí˜¸ë¥¼ ë¶™ì—¬ì¤˜ì•¼ í†µì‹ ì´ ê°€ëŠ¥í•˜ë‹¤. (xxx.xxx.xx.xx:8080)  
ë§Œì•½ 8080ì´ë¼ëŠ” í¬íŠ¸ë¶€ë¶„ì„ ì„ ì–¸í•˜ì§€ì•Šê³  í˜¸ì¶œí•˜ë ¤ë©´ ë‹¤ìŒ ë°©ë²• ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì•¼í•œë‹¤.  
- Tomcatí¬íŠ¸ë¥¼ 80í¬íŠ¸ë¡œ ë³€ê²½í•˜ê¸°
- ngnixë¡œ ë¦¬ë²„ìŠ¤í”„ë¡ì‹œë¥¼ êµ¬í˜„
- Ubuntuì—ì„œ 80í¬íŠ¸ë¡œ ì ‘ì†ì‹œ 8080í¬íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

í”„ë¡œì íŠ¸ì˜ ê²½ìš°ì—” nginxì„¤ì¹˜ë¥¼ í•˜ë©° ë°œìƒí•œ ì˜¤ë¥˜(dpkgì˜¤ë¥˜, Unable to locate package)ë¥¼ í•´ê²°í•˜ì§€ ëª»í•´ì„œ ì–´ì©”ìˆ˜ì—†ì´ Ubuntuì˜ í¬íŠ¸í¬ì›Œë”© ë°©ì‹ì„ ì´ìš©í•˜ê¸°ë¡œ í•˜ì˜€ë‹¤.  
í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ ì„œë²„ì—ì„œ í˜¸ì¶œí•˜ë©´ ê°„ë‹¨í•˜ê²Œ í¬íŠ¸í¬ì›Œë”©ì„ êµ¬í˜„í• ìˆ˜ìˆë‹¤.  
#### í¬íŠ¸í¬ì›Œë”© ë“±ë¡ ëª…ë ¹ì–´
```iptables -A PREROUTING -t nat -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080```
#### í¬íŠ¸í¬ì›Œë”© ì‚­ì œ ëª…ë ¹ì–´
```iptables -D  PREROUTING -t nat -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080```
#### iptables ì¬ë¶€íŒ…í›„ ì´ˆê¸°í™” ë°©ì§€
```sudo apt install iptables-persistent```
```sudo systemctl enabled netfilter-persistent.service```
```sudo netfilter-persistent save```

### ë„ë©”ì¸ 
ë„ë©”ì¸ì€ **ipë¥¼ ì‚¬ëŒì´ ì‰½ê²Œ ê¸°ì–µí•˜ê¸° ìœ„í•´ ë¬¸ìë¡œ ë§Œë“  ì¸í„°ë„· ì£¼ì†Œ**ì´ë‹¤.  
ë„ë©”ì¸ì„ ì‚¬ìš©í•˜ê¸°ìœ„í•´ì„œëŠ” í•´ë‹¹ ë„ë©”ì¸ì„ êµ¬ë§¤í•´ì•¼í•˜ê³  ì´ë¥¼ ë‚´ ì‚¬ì´íŠ¸ipì£¼ì†Œì™€ ì—°ê²°í•´ì•¼í•œë‹¤. ì´ë²ˆ í”„ë¡œì íŠ¸ì˜ ê²½ìš° ê²€ìƒ‰í–ˆì„ë•Œ ì €ë ´í•œ ë„ë©”ì¸ì´ë¼ê³  ë‚˜ì˜¨ [ê°€ë¹„ì•„ ë„ë©”ì¸](https://www.gabia.com/)ì„ ì‚¬ìš©í•˜ì˜€ë‹¤. ([ë¬´ë£Œë„ë©”ì¸ ì‚¬ì´íŠ¸ (freenom)](https://www.freenom.com/en/index.html?lang=en)ë„ ìˆëŠ”ë° ë°°í¬ë¥¼ ì§„í–‰í•  ì ì—ëŠ” ì‚¬ì´íŠ¸ ì ‘ì†ì´ ë¶ˆê°€í–ˆê¸° ë•Œë¬¸ì— ë¶ˆê°€í”¼í•œì„ íƒì´ì—ˆë‹¤.) ë„ë©”ì¸ ë“±ë¡ì€ ì—…ì²´ì˜ ê°€ì´ë“œë¼ì¸ì„ ì°¸ê³ í•˜ì—¬ ë“±ë¡í•˜ë©´ ëœë‹¤.

### SSL ì¸ì¦
SSLì€ **ì„œë²„ì™€ ë¸Œë¼ìš°ì €ê°„ í†µì‹ ì‹œ ì •ë³´ë¥¼ ì•”í˜¸í™”í•˜ì—¬ í•´í‚¹ì„ í†µí•´ ì •ë³´ê°€ ìœ ì¶œë˜ì–´ë„ ë‚´ìš©ì„ ë³´í˜¸í•  ìˆ˜ ìˆëŠ” ë³´ì•ˆì¸ì¦ ì†”ë£¨ì…˜ ê¸°ìˆ **ì´ë‹¤. ê¸°ì—…ê°™ì€ê²½ìš° ì „ë¬¸ ì—…ì²´ë¥¼ ì´ìš©í•˜ì—¬ ìœ ë£Œë¡œ ë°œê¸‰í•˜ì§€ë§Œ ì´ë²ˆ í”„ë¡œì íŠ¸ì˜ ê²½ìš°ëŠ” SSLì¸ì¦ì— ëˆì„ ë“¤ì´ëŠ” ê²ƒì€ ì•„ê¹ë‹¤ëŠ” ìƒê°ì´ ë“¤ì–´ì„œ ë¬´ë£Œ ë°œê¸‰ ì‚¬ì´íŠ¸ì¸ [SSL For Free](https://www.sslforfree.com/)ë¥¼ ì´ìš©í•˜ì˜€ë‹¤.  
ì¸ì¦ì„œ ë°œê¸‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ìƒëµí•˜ë©° (ì°¸ê³ ë¡œ ì‚¬ì´íŠ¸ì—ì„œ ë„ë©”ì¸ ì†Œìœ ê¶Œ í™•ì¸í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ DNS(ë„ë©”ì¸ ë„¤ì„ì„œë²„ì— ì§ì ‘ CNAMEì„ ë“±ë¡)ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•˜ì˜€ë‹¤.) ë°œê¸‰ í›„ SpringBootì— ì ìš©í•˜ë„ë¡ í–ˆë‹¤.  
SpringBootëŠ” ë‚´ì¥ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš©í•˜ëŠ” HttpConnectorì— SSLì„ ì ìš©í•´ì£¼ì–´ í†°ìº£ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° PKCS12ì™€ JKSë§Œ ì§€ì›ì´ ë˜ê¸°ë•Œë¬¸ì— opensslì„ ì‚¬ìš©í•˜ì—¬ ê¸°ì¡´ ì¸ì¦ì„œë¥¼ ë³€ê²½í•˜ì˜€ë‹¤.  
```openssl pkcs12 -export -out keystore.p12 -inkey private.key -in certificate.crt -certfile ca_bundle.crt```
ì´í›„ src/main/resources í•˜ìœ„ì— keystore.p12 íŒŒì¼ì„ ë„£ì–´ë‘ê³   
application.yml ì„¤ì •ì„ ì¶”ê°€í•´ì£¼ë„ë¡ í•œë‹¤.
```yml
server:
  ssl:
    key-store: classpath:keystore.p12
    key-store-password: ${password}
    key-store-type: PKCS12
```
ì´í›„ 443í¬íŠ¸ë¡œ ë“¤ì–´ì˜¤ë©´ 8080ìœ¼ë¡œ ë“¤ì–´ì˜¬ìˆ˜ìˆë„ë¡ í¬íŠ¸í¬ì›Œë”©ì„ ì¶”ê°€í•´ì¤€ë‹¤.  
```iptables -A PREROUTING -t nat -i eth0 -p tcp --dport 443 -j REDIRECT --to-port 8080```  
ì´ì œë¶€í„°ëŠ” ê¸°ì¡´ httpê²½ë¡œë¡œ ì ‘ê·¼ì„ í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë¯€ë¡œ httpë¡œ ì ‘ê·¼ì„ í• ê²½ìš° httpsë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í• ìˆ˜ìˆë„ë¡ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤.
```java
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        ...
        http.requiresChannel(channel -> channel.anyRequest().requiresSecure());
        return http.build();
    }
```

#### ì°¸ê³ í•œ ì‚¬ì´íŠ¸
[https://velog.io/@jjonggang/Spring-Boot-Nginxë¥¼-ì´ìš©í•˜ì—¬-Spring-Bootë¥¼-80ë²ˆ-í¬íŠ¸ë¡œ-í”„ë¡ì‹œí•˜ê¸°](https://velog.io/@jjonggang/Spring-Boot-Nginx%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-Spring-Boot%EB%A5%BC-80%EB%B2%88-%ED%8F%AC%ED%8A%B8%EB%A1%9C-%ED%94%84%EB%A1%9D%EC%8B%9C%ED%95%98%EA%B8%B0)  
[https://velog.io/@shawnhansh/Ubuntu-í¬íŠ¸í¬ì›Œë”©Portforwarding](https://velog.io/@shawnhansh/Ubuntu-%ED%8F%AC%ED%8A%B8%ED%8F%AC%EC%9B%8C%EB%94%A9Portforwarding)  
[https://alkhwa-113.tistory.com/entry/AWS-EC2-ê°€ë¹„ì•„ì—ì„œ-ë„ë©”ì¸ì„-ì‚¬ì„œ-IPì£¼ì†Œì™€-ì—°ê²°ì‹œì¼œë³´ì](https://alkhwa-113.tistory.com/entry/AWS-EC2-%EA%B0%80%EB%B9%84%EC%95%84%EC%97%90%EC%84%9C-%EB%8F%84%EB%A9%94%EC%9D%B8%EC%9D%84-%EC%82%AC%EC%84%9C-IP%EC%A3%BC%EC%86%8C%EC%99%80-%EC%97%B0%EA%B2%B0%EC%8B%9C%EC%BC%9C%EB%B3%B4%EC%9E%90)  
https://foxydog.tistory.com/39  
https://shanepark.tistory.com/442  
